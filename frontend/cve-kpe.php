<section class="grid">
    <div class="panel panel--wide">
        <h2>Сбор таблицы CVE КПЭ</h2>
        <p class="panel-note">Загрузите три таблицы (GLPI, Redscan, KESL). Поддерживаются CSV, XLS и XLSX.</p>

        <?php if (!empty($errors)): ?>
            <div class="form-message">
                <?php foreach ($errors as $error): ?>
                    <div class="form-error"><?php echo htmlspecialchars($error, ENT_QUOTES); ?></div>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>

        <?php if ($downloadUrl): ?>
            <div class="form-message">
                <div class="form-success">Файл сформирован. <a href="<?php echo htmlspecialchars($downloadUrl, ENT_QUOTES); ?>">Скачать результат</a></div>
            </div>
        <?php endif; ?>

        <form class="form-grid" method="post" enctype="multipart/form-data">
            <div class="form-field">
                <label for="glpi">Файл GLPI</label>
                <input type="file" id="glpi" name="glpi" accept=".csv,.xls,.xlsx" required>
            </div>
            <div class="form-field">
                <label for="redscan">Файл Redscan</label>
                <input type="file" id="redscan" name="redscan" accept=".csv,.xls,.xlsx" required>
            </div>
            <div class="form-field">
                <label for="kesl">Файл KESL</label>
                <input type="file" id="kesl" name="kesl" accept=".csv,.xls,.xlsx" required>
            </div>
            <div class="form-field form-field--full">
                <p class="form-hint">Таблица будет собрана согласно заданным правилам и доступна для скачивания в формате XLS.</p>
            </div>
            <div class="action-row">
                <button class="btn" type="submit">Сформировать XLS</button>
            </div>
        </form>
    </div>
    <div class="panel panel--wide">
        <h2>Лог выполнения</h2>
        <div class="placeholder">
            <?php if (!empty($logMessages)): ?>
                <ul>
                    <?php foreach ($logMessages as $message): ?>
                        <li><?php echo htmlspecialchars($message, ENT_QUOTES); ?></li>
                    <?php endforeach; ?>
                </ul>
            <?php else: ?>
                <p>Лог будет доступен после запуска обработки.</p>
            <?php endif; ?>
        </div>
    </div>
</section>
